angular.module("mxPipeline.templates",[]).run(["$templateCache",function(a){a.put("template/mxpipeline.tpl.html",'<div class=mx-pipeline><table class=mx-stage><tbody><tr height=45><td><div class=mx-header><ul><li id="stage-{{ column[mxFieldColumnKey] }}" ng-repeat="column in mxDataProvider"><span class=mx-name>{{ column["name"] }}</span> <span class=mx-stage-value><span class=mx-value>{{ vm.sumValues(column[mxFieldChildren]) | currency:\'R$ \' }} <small>{{ column[mxFieldChildren] | countItem:true }}</small></span></span></li></ul></div></td></tr><tr><td><div class=mx-container><table class=mx-table-content><tbody><tr><td class=mx-stage-item ng-repeat="column in mxDataProvider"><ul id="{{ column[mxFieldColumnKey] }}" mx-droppable><li id="mx-pipeline-key-{{ item[mxFieldChildKey] }}" mx-id="{{ item[mxFieldChildKey] }}" class=item ng-repeat="item in column[mxFieldChildren]" mx-draggable><div class=mx-card><a href="" class=mx-click-card draggable=false><strong><img ng-src="{{ item[mxFieldChildIcon] === undefined ? \'img/profile_120x120.jpg\' : item[mxFieldChildIcon] }}" alt="{{ item[mxFieldChildName] }}" class=mx-profile-icon> {{ item[mxFieldChildName] }}</strong> <small><span class=detail>{{ item[mxFieldChildValue] | currency:\'R$ \' }}</span> <span class=detail>{{ item[mxFieldChildPartner] }}</span></small></a></div><div class=mx-icon-card draggable=false ng-class="{\'state-0\': item[mxFieldChildState] == \'0\', \'state-1\': item[mxFieldChildState] == 1, \'state-2\': item[mxFieldChildState] == 2, \'state-3\': item[mxFieldChildState] == 3, \'state-4\': item[mxFieldChildState] == 4}"><a id=activity-item-click href="" class=icon ng-click="vm.stateClickHandler($event, item[mxFieldChildKey])"></a></div></li></ul></td></tr></tbody></table><div id=mx-stage-actions><ul class=mx-stage-action><li class=mx-trash mx-droppable-action mx-droppable-type=trash><span></span></li><li class=mx-lose mx-droppable-action mx-droppable-type=lose><span>Perdido</span></li><li class=mx-win mx-droppable-action mx-droppable-type=win><span>Ganho</span></li></ul></div></div></td></tr></tbody></table></div>')}]),angular.module("mxPipeline",["mxPipeline.templates"]),angular.module("mxPipeline").filter("countItem",function(){return function(a,b){var c="";return a=a||[],b=b||!1,b&&(c=a.length>1?" itens":" item"),a.length+c}}),angular.module("mxPipeline").service("DataProvider",function(){var a,b,c,d,e=this;e.setFieldColumnId=function(a){b=a},e.setFieldColumnChildren=function(a){c=a},e.setFieldChildId=function(a){d=a},e.set=function(b){a=b},e.get=function(){return a},e.moveRecord=function(e,f,g){var h,i,j;a.forEach(function(a){a[b]===e?angular.isDefined(a[c])&&(a[c].forEach(function(a,b){a[d]===g&&(h=b,i=a)}),angular.isDefined(h)&&a[c].splice(h,1)):a[b]===f&&(j=a)}),angular.isDefined(j)&&(angular.isDefined(j[c])||(j[c]=[]),j[c].push(i))},e.removeRecord=function(e,f){var g;a.forEach(function(a){a[b]===e&&angular.isDefined(a[c])&&(a[c].forEach(function(a,b){a[d]===f&&(g=b)}),angular.isDefined(g)&&a[c].splice(g,1))})}}),angular.module("mxPipeline").directive("mxDraggable",function(){return{require:"^mxPipeline",restrict:"A",link:function(a,b,c,d){var e,f=b[0];f.draggable=!0,f.addEventListener("dragstart",function(a){return a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("parentId",this.parentNode.id),a.dataTransfer.setData("elementId",this.id),this.classList.add("drag"),!1},!1),f.addEventListener("dragend",function(){return this.classList.remove("drag"),!1},!1),f.addEventListener("click",function(){return e=angular.element(this).attr("mx-id"),d.itemClickHandler(e),!1},!1)}}}),angular.module("mxPipeline").directive("mxDroppableAction",["DataProvider",function(a){return{require:"^mxPipeline",scope:{mxDroppableType:"@mxDroppableType"},restrict:"A",link:function(b,c){var d=c[0];d.addEventListener("dragover",function(a){return a.dataTransfer.dropEffect="move",a.preventDefault&&a.preventDefault(),this.classList.add("over"),!1},!1),d.addEventListener("dragenter",function(){return this.classList.add("over"),!1},!1),d.addEventListener("dragleave",function(){return this.classList.remove("over"),!1},!1),d.addEventListener("drop",function(b){var c=document.getElementById(b.dataTransfer.getData("parentId")),d=document.getElementById(b.dataTransfer.getData("elementId")),e=angular.element(d).attr("mx-id"),f=b.dataTransfer.getData("parentId");return this.classList.remove("over"),this.classList.remove("open"),b.stopPropagation&&b.stopPropagation(),c.removeChild(d),a.removeRecord(f,e),console.log(a.get()),!1},!1)}}}]),angular.module("mxPipeline").directive("mxDroppable",["DataProvider",function(a){return{require:"^mxPipeline",restrict:"A",link:function(b,c,d,e){var f,g=c[0];g.addEventListener("dragover",function(a){return a.dataTransfer.dropEffect="move",a.preventDefault&&a.preventDefault(),f=document.getElementById("mx-stage-actions"),angular.element(f).addClass("open"),this.classList.add("over"),!1},!1),g.addEventListener("dragenter",function(){return this.classList.add("over"),!1},!1),g.addEventListener("dragleave",function(){return this.classList.remove("over"),!1},!1),g.addEventListener("drop",function(b){var c=b.dataTransfer.getData("parentId"),d=document.getElementById(b.dataTransfer.getData("elementId")),f=angular.element(d).attr("mx-id"),g=document.getElementById("mx-stage-actions");return this.classList.remove("over"),angular.element(g).removeClass("open"),this.id!=c?(b.stopPropagation&&b.stopPropagation(),this.appendChild(d),a.moveRecord(c,this.id,f),e.onDropHandler(f),!1):void 0},!1)}}}]),angular.module("mxPipeline").directive("mxPipeline",["$timeout",function(){return{scope:{mxDataProvider:"=mxDataProvider",mxOnDrop:"&mxOnDrop",mxItemClick:"&mxItemClick",mxItemStateClick:"&mxItemStateClick",mxFieldColumnKey:"@mxFieldColumnKey",mxFieldColumnName:"@mxFieldColumnName",mxFieldChildren:"@mxFieldChildren",mxFieldChildKey:"@mxFieldChildKey",mxFieldChildName:"@mxFieldChildName",mxFieldChildPartner:"@mxFieldChildPartner",mxFieldChildValue:"@mxFieldChildValue",mxFieldChildState:"@mxFieldChildState",mxFieldChildIcon:"@mxFieldChildIcon"},templateUrl:"template/mxpipeline.tpl.html",restrict:"E",link:function(a,b,c,d){d.initializeDataProvider()},controller:"Pipeline",controllerAs:"vm"}}]),angular.module("mxPipeline").controller("Pipeline",["$scope","$timeout","$log","DataProvider",function(a,b,c,d){var e=this;e.mxFieldColumnKey=a.mxFieldColumnKey,e.mxFieldColumnName=a.mxFieldColumnName,e.mxFieldChildren=a.mxFieldChildren,e.mxFieldChildKey=a.mxFieldChildKey,e.mxFieldChildName=a.mxFieldChildName,e.mxFieldChildPartner=a.mxFieldChildPartner,e.mxFieldChildValue=a.mxFieldChildValue,e.mxFiledChildState=a.mxFiledChildState,e.mxFieldChildIcon=a.mxFieldChildIcon,e.validateAttrs=function(){angular.isDefined(a.mxFieldColumnKey)||c.error("The attribute 'mx-field-column-key' was not declared to your directive."),angular.isDefined(a.mxFieldColumnName)||c.error("The attribute 'mx-field-column-name' was not declared to your directive."),angular.isDefined(a.mxFieldChildren)||c.error("The attribute 'mx-field-children' was not declared to your directive."),angular.isDefined(a.mxFieldChildKey)||c.error("The attribute 'mx-field-child-key' was not declared to your directive."),angular.isDefined(a.mxFieldChildName)||c.error("The attribute 'mx-field-child-name' was not declared to your directive."),angular.isDefined(a.mxFieldChildValue)||c.error("The attribute 'mx-field-child-value' was not declared to your directive.")},e.validateAttrs(),e.onDropHandler=function(c){b(function(){a.$apply(function(a){var b=a.mxOnDrop();"undefined"!=typeof b&&b(c,event)})})},e.itemClickHandler=function(c){b(function(){a.$apply(function(a){var b=a.mxItemClick();"undefined"!=typeof b&&b(c,event)})})},e.stateClickHandler=function(c,d){c.stopPropagation(),b(function(){a.$apply(function(a){var b=a.mxItemStateClick();"undefined"!=typeof b&&b(d,c)})})},e.initializeDataProvider=function(){d.set(a.mxDataProvider),d.setFieldColumnId(e.mxFieldColumnKey),d.setFieldColumnChildren(e.mxFieldChildren),d.setFieldChildId(e.mxFieldChildKey)},e.sumValues=function(a){var b=0;return angular.isArray(a)&&a.length>0&&a.forEach(function(a){a.hasOwnProperty(e.mxFieldChildValue)&&angular.isNumber(a[e.mxFieldChildValue])&&(b+=a[e.mxFieldChildValue])}),b}}]);